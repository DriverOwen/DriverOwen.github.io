function LAppModel(){L2DBaseModel.prototype.constructor.call(this),this.modelHomeDir="",this.modelSetting=null,this.tmpMatrix=[]}LAppModel.prototype=new L2DBaseModel,LAppModel.prototype.load=function(l,e,n){this.setUpdating(!0),this.setInitialized(!1),this.modelHomeDir=e.substring(0,e.lastIndexOf("/")+1),this.modelSetting=new ModelSettingJson;var a=this;this.modelSetting.loadModelSetting(e,function(){var e=a.modelHomeDir+a.modelSetting.getModelFile();a.loadModelData(e,function(e){for(var t=0;t<a.modelSetting.getTextureNum();t++){var i=a.modelHomeDir+a.modelSetting.getTextureFile(t);a.loadTexture(t,i,function(){if(a.isTexLoaded){if(0<a.modelSetting.getExpressionNum()){a.expressions={};for(var e=0;e<a.modelSetting.getExpressionNum();e++){var t=a.modelSetting.getExpressionName(e),i=a.modelHomeDir+a.modelSetting.getExpressionFile(e);a.loadExpression(t,i)}}else a.expressionManager=null,a.expressions={};var o;null==a.eyeBlink&&(a.eyeBlink=new L2DEyeBlink),null!=a.modelSetting.getPhysicsFile()?a.loadPhysics(a.modelHomeDir+a.modelSetting.getPhysicsFile()):a.physics=null,null!=a.modelSetting.getPoseFile()?a.loadPose(a.modelHomeDir+a.modelSetting.getPoseFile(),function(){a.pose.updateParam(a.live2DModel)}):a.pose=null,null!=a.modelSetting.getLayout()&&(null!=(o=a.modelSetting.getLayout()).width&&a.modelMatrix.setWidth(o.width),null!=o.height&&a.modelMatrix.setHeight(o.height),null!=o.x&&a.modelMatrix.setX(o.x),null!=o.y&&a.modelMatrix.setY(o.y),null!=o.center_x&&a.modelMatrix.centerX(o.center_x),null!=o.center_y&&a.modelMatrix.centerY(o.center_y),null!=o.top&&a.modelMatrix.top(o.top),null!=o.bottom&&a.modelMatrix.bottom(o.bottom),null!=o.left&&a.modelMatrix.left(o.left),null!=o.right&&a.modelMatrix.right(o.right));for(e=0;e<a.modelSetting.getInitParamNum();e++)a.live2DModel.setParamFloat(a.modelSetting.getInitParamID(e),a.modelSetting.getInitParamValue(e));for(e=0;e<a.modelSetting.getInitPartsVisibleNum();e++)a.live2DModel.setPartsOpacity(a.modelSetting.getInitPartsVisibleID(e),a.modelSetting.getInitPartsVisibleValue(e));a.live2DModel.saveParam(),a.live2DModel.setGL(l),a.preloadMotionGroup(LAppDefine.MOTION_GROUP_IDLE),a.mainMotionManager.stopAllMotions(),a.setUpdating(!1),a.setInitialized(!0),"function"==typeof n&&n()}})}})})},LAppModel.prototype.release=function(e){var t=Live2DFramework.getPlatformManager();e.deleteTexture(t.texture)},LAppModel.prototype.preloadMotionGroup=function(t){for(var i=this,o=0;o<this.modelSetting.getMotionNum(t);o++){var e=this.modelSetting.getMotionFile(t,o);this.loadMotion(e,this.modelHomeDir+e,function(e){e.setFadeIn(i.modelSetting.getMotionFadeIn(t,o)),e.setFadeOut(i.modelSetting.getMotionFadeOut(t,o))})}},LAppModel.prototype.update=function(){var e;null!=this.live2DModel?(e=2*((UtSystem.getUserTimeMSec()-this.startTimeMSec)/1e3)*Math.PI,this.mainMotionManager.isFinished()&&this.startRandomMotion(LAppDefine.MOTION_GROUP_IDLE,LAppDefine.PRIORITY_IDLE),this.live2DModel.loadParam(),this.mainMotionManager.updateParam(this.live2DModel)||null!=this.eyeBlink&&this.eyeBlink.updateParam(this.live2DModel),this.live2DModel.saveParam(),null==this.expressionManager||null==this.expressions||this.expressionManager.isFinished()||this.expressionManager.updateParam(this.live2DModel),this.live2DModel.addToParamFloat("PARAM_ANGLE_X",30*this.dragX,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_Y",30*this.dragY,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_Z",this.dragX*this.dragY*-30,1),this.live2DModel.addToParamFloat("PARAM_BODY_ANGLE_X",10*this.dragX,1),this.live2DModel.addToParamFloat("PARAM_EYE_BALL_X",this.dragX,1),this.live2DModel.addToParamFloat("PARAM_EYE_BALL_Y",this.dragY,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_X",Number(15*Math.sin(e/6.5345)),.5),this.live2DModel.addToParamFloat("PARAM_ANGLE_Y",Number(8*Math.sin(e/3.5345)),.5),this.live2DModel.addToParamFloat("PARAM_ANGLE_Z",Number(10*Math.sin(e/5.5345)),.5),this.live2DModel.addToParamFloat("PARAM_BODY_ANGLE_X",Number(4*Math.sin(e/15.5345)),.5),this.live2DModel.setParamFloat("PARAM_BREATH",Number(.5+.5*Math.sin(e/3.2345)),1),null!=this.physics&&this.physics.updateParam(this.live2DModel),null==this.lipSync&&this.live2DModel.setParamFloat("PARAM_MOUTH_OPEN_Y",this.lipSyncValue),null!=this.pose&&this.pose.updateParam(this.live2DModel),this.live2DModel.update()):LAppDefine.DEBUG_LOG&&console.error("Failed to update.")},LAppModel.prototype.setRandomExpression=function(){var e=[];for(var t in this.expressions)e.push(t);var i=parseInt(Math.random()*e.length);this.setExpression(e[i])},LAppModel.prototype.startRandomMotion=function(e,t){var i=this.modelSetting.getMotionNum(e),o=parseInt(Math.random()*i);this.startMotion(e,o,t)},LAppModel.prototype.startMotion=function(t,i,o){var e=this.modelSetting.getMotionFile(t,i);if(null!=e&&""!=e){if(o==LAppDefine.PRIORITY_FORCE)this.mainMotionManager.setReservePriority(o);else if(!this.mainMotionManager.reserveMotion(o))return void(LAppDefine.DEBUG_LOG&&console.log("Motion is running."));var l,n=this;null==this.motions[t]?this.loadMotion(null,this.modelHomeDir+e,function(e){l=e,n.setFadeInFadeOut(t,i,o,l)}):(l=this.motions[t],n.setFadeInFadeOut(t,i,o,l))}else LAppDefine.DEBUG_LOG&&console.error("Failed to motion.")},LAppModel.prototype.setFadeInFadeOut=function(e,t,i,o){var l,n,a=this.modelSetting.getMotionFile(e,t);o.setFadeIn(this.modelSetting.getMotionFadeIn(e,t)),o.setFadeOut(this.modelSetting.getMotionFadeOut(e,t)),LAppDefine.DEBUG_LOG&&console.log("Start motion : "+a),null==this.modelSetting.getMotionSound(e,t)||(l=this.modelSetting.getMotionSound(e,t),(n=document.createElement("audio")).src=this.modelHomeDir+l,LAppDefine.DEBUG_LOG&&console.log("Start sound : "+l),n.play()),this.mainMotionManager.startMotionPrio(o,i)},LAppModel.prototype.setExpression=function(e){var t=this.expressions[e];LAppDefine.DEBUG_LOG&&console.log("Expression : "+e),this.expressionManager.startMotion(t,!1)},LAppModel.prototype.draw=function(e){MatrixStack.push(),MatrixStack.multMatrix(this.modelMatrix.getArray()),this.tmpMatrix=MatrixStack.getMatrix(),this.live2DModel.setMatrix(this.tmpMatrix),this.live2DModel.draw(),MatrixStack.pop()},LAppModel.prototype.hitTest=function(e,t,i){console.log("XOWEN:TX"+t+"TY"+i);for(var o=this.modelSetting.getHitAreaNum(),l=0;l<o;l++)if(e==this.modelSetting.getHitAreaName(l)){var n=this.modelSetting.getHitAreaID(l);return this.hitTestSimple(n,t,i)}return!1};